function compileColumn(o,e){for(var i=[],t=1;t<o.length;t++)i[t-1]=o[t][e].toUpperCase();return i}function compileAmount(o){for(var e=[],i=1;i<o.length;i++)e[i-1]=parseFloat(o[i][9]);return e}function getTotalContributions(o){return totalContributions=0,$.each(o.amount,function(o,e){totalContributions+=e}),totalContributions}function initializePieChart(o,e,i){$("#pieChart").replaceWith('<canvas id="pieChart" width="400" height="400"></canvas>');var t=document.getElementById("pieChart").getContext("2d"),n=new Chart(t),a=[{value:o,color:e[0],highlight:e[1],label:i}];n.Doughnut(a,{segmentShowStroke:!1,showTooltips:!1,animationEasing:"easeInOutCubic",responsive:!0})}function loadingDone(){getTotalContributions(deBlasio),dataReady=!0,initializePieChart(totalContributions,pieColor),$("#loading").fadeOut("fast"),$("#title,.majors").css("visibility","visible").hide(),$("#logo,#title,#subtitleAmount,#intro,footer,.majors").fadeIn(3e3)}function fixBorough(o){return $.each(o,function(e,i){switch(i){case"M":o[e]="MANHATTAN";break;case"Z":o[e]="OUTSIDE NYC";break;case"K":o[e]="BROOKLYN";break;case"B":o[e]="BROOKLYN";break;case"X":o[e]="BRONX";break;case"S":o[e]="STATEN ISLAND";break;case"Q":o[e]="QUEENS";break;case"U":o[e]="UNREPORTED"}}),o}function findTop(o,e){for(var i=[],t=[],n=0,a=[],l=0;l<o[e].length;l++)-1!==$.inArray(o[e][l],i)?t[$.inArray(o[e][l],i)]+=o.amount[l]:(i[n]=o[e][l],t[n]=o.amount[l],n++);return 1===i[1].length&&(i=fixBorough(i)),$.each(i,function(o,e){a.push({category:""!==e?i[o]:"UNREPORTED",amount:t[o]})}),a.sort(function(o,e){return e.amount-o.amount}),a=a.slice(0,5),console.log(a),a}function generateKey(o){$("#key p").remove(),$("#key").hide(),$.each(o,function(e){$("#key").append("<p><span id=textColor"+e+">"+o[e].category+"</span> donations totaled <span id=amountColor"+e+">$"+o[e].amount.toFixed(2)+"</span></p>"),$("#textColor"+e+",#amountColor"+e).css({background:sliceMainColor[e]})}),$("#key").fadeIn(2e3)}function graphTopData(o,e){$("#pieChart").replaceWith('<canvas id="pieChart" width="400" height="400"></canvas>');var i=[],t=0;$.each(e,function(n){i.push({value:e[n].amount/o,color:sliceMainColor[n],highlight:sliceHighColor[n],label:e[n].category}),t+=e[n].amount}),i.push({value:(o-t)/o,color:pieColor[0],highlight:pieColor[1],label:"Other Contributions"});var n=document.getElementById("pieChart").getContext("2d"),a=new Chart(n);a.Doughnut(i,{animationEasing:"easeInBack",tooltipTemplate:"<%if (label){%><%=label%>: <%}%> <%= (value*100).toFixed(2) %>%",responsive:!0}),generateKey(e)}function searchForSlice(o,e,i){for(var t=0,n=0;n<o[e].length;n++)o[e][n]===i&&(t+=o.amount[n]);return t}function graphSingleData(o,e,i){$("#pieChart").replaceWith('<canvas id="pieChart" width="400" height="400"></canvas>');var t=[],n=e>0?!0:!1;t.push({value:e/o,color:sliceMainColor[0],highlight:sliceHighColor[0],label:i}),t.push({value:(o-e)/o,color:pieColor[0],highlight:pieColor[1],label:"Other Contributions"});var a=document.getElementById("pieChart").getContext("2d"),l=new Chart(a);l.Doughnut(t,{segmentShowStroke:n,animationEasing:"easeInBack",tooltipTemplate:"<%if (label){%><%=label%>: <%}%> <%= (value*100).toFixed(2) %>%",responsive:!0}),$("#key p").remove(),$("#key").hide(),$("#key").append("<p><span>"+t[0].label.toUpperCase()+"</span> donations totaled <span>$"+e.toFixed(2)+"</span></p>"),$("#key span").css({background:sliceMainColor[0]}),$("#key").fadeIn(2e3)}function loadAllData(){var o="csv/2013_Campaign_Contributions.csv",e="csv/2009_Campaign_Contributions.csv",i="csv/1994_Campaign_Contributions.csv",t="csv/1990_Campaign_Contributions.csv";$.when($.get(t,function(o){var e=$.csv.toArrays(o);dinkins.borough=compileColumn(e,3),dinkins.city=compileColumn(e,4),dinkins.state=compileColumn(e,5),dinkins.zips=compileColumn(e,6),dinkins.occupation=compileColumn(e,7),dinkins.amount=compileAmount(e),$("#loading").append(".")}),$.get(i,function(o){var e=$.csv.toArrays(o);giuliani.borough=compileColumn(e,3),giuliani.city=compileColumn(e,4),giuliani.state=compileColumn(e,5),giuliani.zips=compileColumn(e,6),giuliani.occupation=compileColumn(e,7),giuliani.amount=compileAmount(e),$("#loading").append(".")}),$.get(e,function(o){var e=$.csv.toArrays(o);bloomberg.donorName=compileColumn(e,2),bloomberg.borough=compileColumn(e,3),bloomberg.city=compileColumn(e,4),bloomberg.state=compileColumn(e,5),bloomberg.zips=compileColumn(e,6),bloomberg.occupation=compileColumn(e,7),bloomberg.employer=compileColumn(e,8),bloomberg.amount=compileAmount(e),$("#loading").append(".")}),$.get(o,function(o){var e=$.csv.toArrays(o);deBlasio.borough=compileColumn(e,3),deBlasio.city=compileColumn(e,4),deBlasio.state=compileColumn(e,5),deBlasio.zips=compileColumn(e,6),deBlasio.occupation=compileColumn(e,7),deBlasio.amount=compileAmount(e),$("#loading").append(".")})).then(loadingDone)}var deBlasio={},bloomberg={},giuliani={},dinkins={},totalContributions=0,dataReady=!1,majorMode="deBlasio",pieColor=["#2ecc71","#27ae60"],sliceMainColor=["#e74c3c","#3498db","#e67e22","#9b59b6","#f1c40f"],sliceHighColor=["#c0392b","#2980b9","#d35400","#8e44ad","#f39c12"];$(document).ready(function(){$("#logo,#subtitleAmount,#intro,footer").hide(),$("#title,.majors").css("visibility","hidden"),loadAllData(),$(".majors").on("click",function(){majorMode=$(this).attr("id");var o=Math.round(getTotalContributions(window[majorMode]));initializePieChart(o,pieColor),$("#key p").remove(),$("#key").hide(),"bloomberg"===$(this).attr("id")?($(".menuItems a").hide(),$("#donors").show()):($(".menuItems a").show(),$("#donors").hide()),$("#logo").css({"background-image":"url("+$(this).attr("src")+")"}),$("#subtitleAmount").html("$"+o+".00"),$("#majorName").html($(this).attr("alt")),$("#majorYear").html($(this).attr("data-year")),$("#majorMoney").html(o.toString().slice(0,o.toString().length-6))}),$(".menu").on({mouseenter:function(){$(".menuItems").slideDown()},mouseleave:function(){$(".menuItems").slideUp()},click:function(){$(".menuItems").is(":hidden")?$(".menuItems").slideDown():$(".menuItems").slideUp("slow")}}),$(".menuItems a").on("click",function(){if($(".menu").removeClass("pulsate"),"donors"===$(this).attr("id")){var o=searchForSlice(window[majorMode],"donorName","BLOOMBERG, MICHAEL R");graphSingleData(getTotalContributions(window[majorMode]),o,"BLOOMBERG")}else{var e=findTop(window[majorMode],$(this).attr("id"));graphTopData(totalContributions,e),generateKey(e)}}),$("#enter").on("click",function(){var o=searchForSlice(window[majorMode],$("#database").val(),$("#query").val().toUpperCase());graphSingleData(getTotalContributions(window[majorMode]),o,$("#query").val())})});