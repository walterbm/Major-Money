function loadingContent(){var e=10591470,o=window.setInterval(function(){var t=e.toString();$(".count_down").html("$"+t.slice(0,2)+","+t.slice(2,5)+","+t.slice(5,8)+".00"),10595440===e&&window.clearInterval(o),e+=10},1)}function prepRadialMenu(){for(var e=document.querySelectorAll(".circle a"),o=0,t=e.length;t>o;o++)e[o].style.left=(38-35*Math.cos(-.5*Math.PI-2*(1/t)*o*Math.PI)).toFixed(4)+"%",e[o].style.top=(40+35*Math.sin(-.5*Math.PI-2*(1/t)*o*Math.PI)).toFixed(4)+"%"}function loadingDone(){$("#title").css("visibility","visible").hide(),$("#logo,#title,#intro,footer").fadeIn(3e3)}function initializePieChart(e,o,t){var a=document.getElementById("pieChart").getContext("2d"),n=new Chart(a),i=[{value:e,color:o[0],highlight:o[1],label:t}];n.Doughnut(i,{segmentShowStroke:!1,showTooltips:!1,animationEasing:"easeInOutCubic",responsive:!0})}function fixBorough(e){return $.each(e,function(o,t){switch(t){case"M":e[o]="MANHATTAN";break;case"Z":e[o]="OUTSIDE NYC";break;case"K":e[o]="BROOKLYN";break;case"X":e[o]="BRONX";break;case"S":e[o]="STATEN ISLAND";break;case"Q":e[o]="QUEENS";break;case"":e[o]="UNREPORTED"}}),e}function findTop(e){var o=[],t=[],a=0,n=[];return $.each(e,function(e,n){-1!==$.inArray(n,o)?t[$.inArray(n,o)]+=amount[e]:(o[a]=n,t[a]=amount[e],a++)}),1===o[1].length&&(o=fixBorough(o)),$.each(o,function(e,a){n.push({category:""!==a?o[e]:"UNREPORTED",amount:t[e]})}),n.sort(function(e,o){return o.amount-e.amount}),n=n.slice(0,5)}function generateKey(e){$("#key p").remove(),$("#key").hide(),$.each(e,function(o){$("#key").append("<p><span id=textColor"+o+">"+e[o].category+"</span> donations totaled <span id=amountColor"+o+">$"+e[o].amount.toFixed(2)+"</span></p>"),$("#textColor"+o+",#amountColor"+o).css({background:sliceMainColor[o]})}),$("#key").fadeIn(2e3)}function graphTopData(e,o){$("#pieChart").replaceWith('<canvas id="pieChart" width="400" height="400"></canvas>');var t=[],a=0;$.each(o,function(n){t.push({value:o[n].amount/e,color:sliceMainColor[n],highlight:sliceHighColor[n],label:o[n].category}),a+=o[n].amount}),t.push({value:(e-a)/e,color:pieColor[0],highlight:pieColor[1],label:"Other Contributions"});var n=document.getElementById("pieChart").getContext("2d"),i=new Chart(n);i.Doughnut(t,{animationEasing:"easeInBack",tooltipTemplate:"<%if (label){%><%=label%>: <%}%> <%= (value*100).toFixed(2) %>%",responsive:!0}),generateKey(o)}function searchForSlice(e,o){var t=0;return $.each(e,function(e,a){a===o&&(t+=amount[e])}),console.log(t),t}function graphSingleData(e,o,t){$("#pieChart").replaceWith('<canvas id="pieChart" width="400" height="400"></canvas>');var a=[],n=o>0?!0:!1;a.push({value:o/e,color:sliceMainColor[0],highlight:sliceHighColor[0],label:t}),a.push({value:(e-o)/e,color:pieColor[0],highlight:pieColor[1],label:"Other Contributions"});var i=document.getElementById("pieChart").getContext("2d"),r=new Chart(i);r.Doughnut(a,{segmentShowStroke:n,animationEasing:"easeInBack",tooltipTemplate:"<%if (label){%><%=label%>: <%}%> <%= (value*100).toFixed(2) %>%",responsive:!0}),$("#key p").remove(),$("#key").hide(),$("#key").append("<p><span>"+a[0].label.toUpperCase()+"</span> donations totaled <span>$"+o.toFixed(2)+"</span></p>"),$("#key span").css({background:sliceMainColor[0]}),$("#key").fadeIn(2e3)}function bloombergify(){for(totalContributions=0;amount.length>0;)amount.pop();$("#logo,#intro,#key").hide(),$("#title").css("visibility","hidden"),$(".menu .circle a").remove(),$(".menu .circle").append('<a id="donors">Donors</a>'),prepRadialMenu(),$("#majorName").html("Michael Bloomberg"),$("#majorMoney").html("100"),$("#majorYear").html("2009"),$("#logo").css({"background-image":"url(../img/michael.jpg)"}),$.ajax({url:"csv/2009_Campaign_Contributions.csv",type:"GET",success:function(e){for(var o=$.csv.toArrays(e),t=1;t<o.length;t++)donorName[t-1]=o[t][13].toUpperCase(),cCode[t-1]=o[t][14].toUpperCase(),borough[t-1]=o[t][18].toUpperCase(),city[t-1]=o[t][19].toUpperCase(),state[t-1]=o[t][20].toUpperCase(),zips[t-1]=o[t][21],occupation[t-1]=o[t][22].toUpperCase(),employer[t-1]=o[t][23].toUpperCase(),amount[t-1]=parseFloat(o[t][28]);$.each(amount,function(e,o){totalContributions+=o}),dataReady=!0,console.log(totalContributions),console.log(donorName[3]);var a=totalContributions.toString();$(".count_down").html("$"+a.slice(0,3)+","+a.slice(3,6)+","+a.slice(6,9)+".00"),initializePieChart(totalContributions,pieColor,"")},complete:loadingDone}),$("#donors").on("click",function(){console.log("!!!");var e=searchForSlice(donorName,"BLOOMBERG, MICHAEL R");graphSingleData(totalContributions,e,"BLOOMBERG")})}var donorName=[],cCode=[],borough=[],city=[],state=[],zips=[],occupation=[],employer=[],amount=[],totalContributions=0,dataReady=!1,pieColor=["#2ecc71","#27ae60"],sliceMainColor=["#e74c3c","#3498db","#e67e22","#9b59b6","#f1c40f"],sliceHighColor=["#c0392b","#2980b9","#d35400","#8e44ad","#f39c12"];$(document).ready(function(){prepRadialMenu(),$("#logo,#intro,footer").hide(),$("#title").css("visibility","hidden");var e=document.createElement("h2"),o=document.getElementById("chartHolder");e.setAttribute("class","count_down"),e.appendChild(document.createTextNode("$10,595,440.00")),document.body.insertBefore(e,o),$.ajax({url:"csv/2013_Campaign_Contributions.csv",type:"GET",beforeSend:loadingContent,success:function(e){for(var o=$.csv.toArrays(e),t=1;t<o.length;t++)borough[t-1]=o[t][18].toUpperCase(),city[t-1]=o[t][19].toUpperCase(),state[t-1]=o[t][20].toUpperCase(),zips[t-1]=o[t][21],occupation[t-1]=o[t][22].toUpperCase(),employer[t-1]=o[t][23].toUpperCase(),amount[t-1]=parseFloat(o[t][28]);$.each(amount,function(e,o){totalContributions+=o}),dataReady=!0,initializePieChart(totalContributions,pieColor,"$10 Million")},complete:loadingDone}),$("#bloomberg").on("change",function(){this.checked===!0?bloombergify():location.reload()}),$(".menu").mouseenter(function(){$(".menu-button").addClass("open")}),$(".menu").mouseleave(function(){$(".menu-button").removeClass("open")}),$(".menu-button").on("click",function(e){e.preventDefault(),$(".menu-button").removeClass("pulsate"),$(".circle").toggleClass("open")}),$(".circle a").on("click",function(){if($(".circle,.menu-button").removeClass("open"),"maxDonations"===$(this).attr("id")){var e=searchForSlice(amount,4950);graphSingleData(totalContributions,e,"MAX DONATIONS")}else{var o=findTop(window[$(this).attr("id")]);graphTopData(totalContributions,o),generateKey(o)}}),$("#enter").on("click",function(){var e=searchForSlice(window[$("#database").val()],$("#query").val().toUpperCase());graphSingleData(totalContributions,e,$("#query").val())})});